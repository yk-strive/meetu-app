(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/send/voice"],{"02b5":function(e,t,n){"use strict";var o,a=function(){var e=this,t=e.$createElement;e._self._c},i=[];n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"a",function(){return o})},"10d5":function(e,t,n){"use strict";(function(e){n("e1e3"),n("921b");o(n("66fd"));var t=o(n("1b2d"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},"1b2d":function(e,t,n){"use strict";n.r(t);var o=n("02b5"),a=n("a1fa");for(var i in a)"default"!==i&&function(e){n.d(t,e,function(){return a[e]})}(i);n("c2a9");var c,r=n("f0c5"),s=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],c);t["default"]=s.exports},8175:function(e,t,n){},a1fa:function(e,t,n){"use strict";n.r(t);var o=n("cca3"),a=n.n(o);for(var i in o)"default"!==i&&function(e){n.d(t,e,function(){return o[e]})}(i);t["default"]=a.a},c2a9:function(e,t,n){"use strict";var o=n("8175"),a=n.n(o);a.a},cca3:function(e,t,n){"use strict";(function(e,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=s(n("a34a")),i=s(n("7687")),c=s(n("c478")),r=n("2f62");function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n,o,a,i,c){try{var r=e[i](c),s=r.value}catch(l){return void n(l)}r.done?t(s):Promise.resolve(s).then(o,a)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var i=e.apply(t,n);function c(e){l(i,o,a,c,r,"next",e)}function r(e){l(i,o,a,c,r,"throw",e)}c(void 0)})}}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){v(e,t,n[t])})}return e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=e.getRecorderManager(),p=e.createInnerAudioContext();p.autoplay=!0;var m={name:"sendVoice",components:{},mixins:[c.default],data:function(){return{voiceCancel:!1,timer:null,intervalTime:0,isRecord:!1,isRecordEnd:!1,voiceTempPath:"",audioPlay:!1}},onLoad:function(){var e=this;p.onEnded(function(){console.log(o("播放结束"," at pages\\send\\voice.vue:66")),e.audioPlay=!1}),f.onStop(function(t){console.log(o("录音停止"+JSON.stringify(t)," at pages\\send\\voice.vue:71")),e.voiceTempPath=t.tempFilePath})},watch:{modalName:function(){var e=this;"toastModal"==this.modalName&&setTimeout(function(){e.modalName=""},1500)}},computed:d({},(0,r.mapGetters)(["token"]),{intIntervalTime:function(){return Math.round(this.intervalTime)}}),methods:{touchStartHandle:function(){var t=u(a.default.mark(function t(){var n;return a.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this,this.voiceCancel=!1,"android"!=e.getSystemInfoSync().platform){t.next=8;break}return t.next=5,i.default.requestAndroidPermission("android.permission.RECORD_AUDIO");case 5:n=t.sent,console.log(o("权限管理222222",n," at pages\\send\\voice.vue:98")),1==n?(console.log(o("权限管理----",n," at pages\\send\\voice.vue:100")),this.recordVoiceHandle(),this.voiceCancel=!1):(console.log(o("权限管理++++",n," at pages\\send\\voice.vue:105")),console.log(o("未给录音权限"," at pages\\send\\voice.vue:106")),this.voiceCancel=!0);case 8:"ios"==e.getSystemInfoSync().platform&&(i.default.judgeIosPermission("record")?(this.recordVoiceHandle(),this.voiceCancel=!1):this.voiceCancel=!0);case 9:case"end":return t.stop()}},t,this)}));function n(){return t.apply(this,arguments)}return n}(),recordVoiceHandle:function(){var e=this,t=this;if(console.log(o("10101010010000000",this.voiceCancel," at pages\\send\\voice.vue:136")),t.voiceCancel)return!1;t.timer=setInterval(function(){if(t.intervalTime+=.5,t.intervalTime>=60)return t.modalShow("toastModal","录音最多录制6秒"),f.stop(),clearInterval(e.timer),e.timer=null,e.isRecordEnd=!0,e.isRecord=!1,!1;t.intervalTime>=.5&&!t.isRecord&&(console.log(o("录音开始"," at pages\\send\\voice.vue:152")),t.intervalTime=0,t.isRecord=!0,f.start({format:"mp3",duration:6e4}))},500)},touchCancelHandle:function(){console.log(o("touchCancel"," at pages\\send\\voice.vue:163")),this.voiceCancel=!0,f.stop(),clearInterval(this.timer),this.timer=null,this.isRecord=!1},touchEndHandle:function(){var e=this;console.log(o("111111111111111",this.voiceCancel," at pages\\send\\voice.vue:172")),e.intervalTime<=.5?(e.modalShow("toastModal","录音太短了"),console.log(o("录音太短了"," at pages\\send\\voice.vue:175")),f.stop(),clearInterval(e.timer),e.timer=null,e.isRecord=!1,e.voiceCancel=!0):(clearInterval(this.timer),this.isRecord&&(this.isRecordEnd=!0,setTimeout(function(){f.stop(),e.isRecord=!1,console.log(o(e.isRecord," at pages\\send\\voice.vue:190"))},500)))},resetVoiceHandle:function(){this.isRecordEnd=!1,this.audioPlay=!1,this.intervalTime=0,this.voiceTempPath=""},playVoiceHandle:function(){this.audioPlay?(p.pause(),this.audioPlay=!1):this.voiceTempPath&&(p.src=this.voiceTempPath,p.play(),this.audioPlay=!0,console.log(o(p.paused," at pages\\send\\voice.vue:214")))},sendVoiceHandle:function(){var t=this;e.uploadFile({url:"https://api.meetu.letwx.com/v2/sys/upload-voice?token="+t.token,filePath:t.voiceTempPath,name:"voicefile",formData:{name:"voicefile",formData:JSON.stringify({sort:0})},success:function(n){console.log(o("upVoiceok",JSON.parse(n.data)," at pages\\send\\voice.vue:232"));var a=JSON.parse(n.data).data.voiceUrl;t.$http1.post("signal/send",{type:2,content:a,seconds:t.intIntervalTime}).then(function(t){console.log(o("语音信号",t," at pages\\send\\voice.vue:239")),getApp().globalData.sendSignal=!0,e.navigateBack({detail:1})})},fail:function(e){console.log(o("err",e," at pages\\send\\voice.vue:248"))}})}},onHide:function(){console.log(o("onHide"," at pages\\send\\voice.vue:254"))}};t.default=m}).call(this,n("6e42")["default"],n("0de9")["default"])}},[["10d5","common/runtime","common/vendor"]]]);