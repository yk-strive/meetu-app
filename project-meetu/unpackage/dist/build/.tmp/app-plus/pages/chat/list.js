(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/chat/list"],{"20f8":function(e,t,n){"use strict";var o,i=function(){var e=this,t=e.$createElement;e._self._c},r=[];n.d(t,"b",function(){return i}),n.d(t,"c",function(){return r}),n.d(t,"a",function(){return o})},"42b3":function(e,t,n){},4352:function(e,t,n){"use strict";(function(e,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=l(n("c478")),r=u(n("a115")),a=n("db78"),s=l(n("8a5c")),c=n("2f62");function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};o.get||o.set?Object.defineProperty(t,n,o):t[n]=e[n]}return t.default=e,t}function l(e){return e&&e.__esModule?e:{default:e}}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){f(e,t,n[t])})}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(){return n.e("components/mix-pulldown-refresh/mix-pulldown-refresh").then(n.bind(null,"7eee"))},m=function(){return n.e("components/mix-load-more/mix-load-more").then(n.bind(null,"9cfe"))},p={name:"chatlist",components:{mixPulldownRefresh:h,mixLoadMore:m},mixins:[i.default],data:function(){return{enableScroll:!0,loadType:"",refreshing:0,pageUnload:!1,removeItemInfo:null}},computed:d({},(0,c.mapGetters)(["token"]),(0,c.mapState)({WS:function(e){return e.socketInfo.WS},list:function(e){return e.socketInfo.list},chatMsg:function(e){return e.socketInfo.chatMsg},deleteErr:function(e){return e.socketInfo.deleteErr}})),watch:{list:function(e,t){this.list||""!=this.loadType||this.pageUnload||this.modalShow("toastModal","还没有和ta人交流过"),this.list.length%this.pageSize!=0&&this.page>1&&e.length==t.length&&(this.loadMoreStatus=2)},chatMsg:function(e,t){this.list.map(function(t){t.user_id==e.user_id&&(t.id=e.id,t.type=e.type,t.content=e.content,t.unread=Number(t.unread)+1,t.created_at=e.created_at,t.created_at_format=r.timeFormat(e.created_at))}),this.list.sort(r.compare("created_at"))},deleteErr:function(e){0==e.error&&(this.modalName="",this.list.splice(this.removeItemInfo.index,1))}},onLoad:function(){this.ws_GetChatList()},onShow:function(){this.pageUnload=!1},methods:{ws_init:function(){var t=this,n=new s.default({url:"wss://api.meetu.letwx.com/im?token="+t.token,timeout:3e4,isSendHeart:!0,heartData:{msgType:"ping",data:{}},isReconnection:!0,reConnectTime:3e3,debug:!1,params:{},onSocketOpen:function(e){},onSocketMessage:function(e){t.$store.dispatch("setSocketState",e)},onSocketError:function(e){t.$store.dispatch("setSocketStateErr",e)},onSocketClose:function(e){}});console.log(e("--socket--",n," at pages\\chat\\list.vue:139")),t.$store.dispatch("WS",n),n.initSocket()},ws_GetChatList:function(e){var t=this,n=this;if(e&&(this.loadType=e,"refresh"===e&&(this.showLoadMore=!1,this.loadMoreStatus=0,this.page=1,this.$store.commit("emptyInfo","list")),"add"===e)){if(2==this.loadMoreStatus)return!1;this.page++,this.showLoadMore=!0,setTimeout(function(){t.loadMoreStatus=1},100)}n.WS.sendSocketMessage({msgType:"getChatLogList",data:{page:n.page,pageSzie:n.pageSize}},function(e){setTimeout(function(){n.$refs.mixPulldownRefresh&&n.$refs.mixPulldownRefresh.endPulldownRefresh()},200)})},ws_read:function(e){var t=this;this.WS.sendSocketMessage({msgType:"read",data:{user_id:e}},function(e){t.clog("----读取未读消息OK----",e)})},ws_delete:function(e){var t=this;this.WS.sendSocketMessage({msgType:"delete",data:{user_id:e.userId}},function(e){t.clog("----读取未读消息OK----",e)})},onPulldownReresh:(0,a.throttle)(function(){var e=this;e.ws_GetChatList("refresh")},5e3,function(){var e=this;e.$refs.mixPulldownRefresh&&e.$refs.mixPulldownRefresh.endPulldownRefresh()}),loadMore:function(){this.ws_GetChatList("add")},linkChat:function(e){this.ws_read(e.user_id),o.navigateTo({url:"./chat?chatUserId="+e.user_id,animationDuration:300,animationType:"fade-in"})},removeChatItem:function(e,t){this.removeItemInfo={userId:e,index:t},this.modalShow("dialogModal","删除会话?")},setEnableScroll:function(e){this.enableScroll!==e&&(this.enableScroll=e)},dialogConfirm:function(){this.ws_delete(this.removeItemInfo)},hideModal:function(){this.modalName="","dialogModal"==this.modalName&&(this.removeItemInfo=null)}},onHide:function(){this.pageUnload=!0,this.$store.commit("emptyInfo","list")},onUnload:function(){this.pageUnload=!0,this.$store.commit("emptyInfo","list")}};t.default=p}).call(this,n("0de9")["default"],n("6e42")["default"])},"7a3c":function(e,t,n){"use strict";n.r(t);var o=n("4352"),i=n.n(o);for(var r in o)"default"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r);t["default"]=i.a},"8d53":function(e,t,n){"use strict";var o=n("42b3"),i=n.n(o);i.a},b796:function(e,t,n){"use strict";n.r(t);var o=n("20f8"),i=n("7a3c");for(var r in i)"default"!==r&&function(e){n.d(t,e,function(){return i[e]})}(r);n("8d53");var a,s=n("f0c5"),c=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);t["default"]=c.exports},d699:function(e,t,n){"use strict";(function(e){n("e1e3"),n("921b");o(n("66fd"));var t=o(n("b796"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])}},[["d699","common/runtime","common/vendor"]]]);