(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/coin"],{1870:function(t,e,n){"use strict";n.r(e);var r=n("cc4d"),a=n("c7d3");for(var o in a)"default"!==o&&function(t){n.d(e,t,function(){return a[t]})}(o);n("84fd");var i=n("2877"),u=Object(i["a"])(a["default"],r["a"],r["b"],!1,null,null,null);e["default"]=u.exports},"27e3":function(t,e,n){"use strict";(function(t,r){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=u(n("a34a")),o=u(n("c478")),i=n("2f62");function u(t){return t&&t.__esModule?t:{default:t}}function s(t,e,n,r,a,o,i){try{var u=t[o](i),s=u.value}catch(c){return void n(c)}u.done?e(s):Promise.resolve(s).then(r,a)}function c(t){return function(){var e=this,n=arguments;return new Promise(function(r,a){var o=t.apply(e,n);function i(t){s(o,r,a,i,u,"next",t)}function u(t){s(o,r,a,i,u,"throw",t)}i(void 0)})}}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){d(t,e,n[e])})}return t}function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var f=function(){return n.e("meetu-ui/components/cu-modal").then(n.bind(null,"f079"))},p={name:"coin",components:{cuModal:f},mixins:[o.default],computed:l({},(0,i.mapGetters)(["userInfo"])),data:function(){return{modalName:"",pointsList:[],pointsPropery:[],payOk:!1,orderSn:null,orderInfo:null}},watch:{payOk:function(t,e){this.payOk&&this.api_UserInfo()}},onLoad:function(){this.api_PointsList(),this.api_PointsProperty()},methods:{api_PointsList:function(){var t=this;this.$http1.post("points/list",{page:t.page}).then(function(e){t.pointsList=e.data})},api_PointsProperty:function(){var t=this;this.$http1.post("points/property",{},{custom:{istoken:!1}}).then(function(e){t.pointsPropery=e.data})},api_UserInfo:function(){var e=this;this.$http1.post("user/info").then(function(t){e.$store.dispatch("changeVal",{stateKey:"userInfo",newValue:t.data})}).catch(function(e){console.log(t("userinfo-err",e," at pages\\user\\coin.vue:120"))})},api_OrderCreate:function(){var t=c(a.default.mark(function t(e){var n,r;return a.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(n=this,e){t.next=4;break}return n.modalShow("toastModal","请选择充值规格"),t.abrupt("return",!1);case 4:return t.next=6,n.$http1.post("order/create",{fee:e.money,type:1,property:e.id,pay_type:1,status:"unpaid"});case 6:if(r=t.sent,n.clog("下单",r),0!=r.code){t.next=13;break}return this.orderSn=r.data.order_sn,t.abrupt("return",r.data.order_sn);case 13:return n.modalShow("toastModal",r.msg),t.abrupt("return",!1);case 15:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),api_OrderCancel:function(){var t=c(a.default.mark(function t(){var e,n;return a.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.orderSn){t.next=2;break}return t.abrupt("return",!1);case 2:return e=this,t.next=5,this.$http1.post("order/cancel",{order_sn:e.orderSn});case 5:n=t.sent,0==n.code&&(this.orderSn=null,e.modalShow("toastModal","订单删除成功"));case 7:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),api_WxPay:function(){var t=c(a.default.mark(function t(e){var n,o,i;return a.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",!1);case 2:return n=this,t.next=5,n.$http1.post("wxapay/pay-params",{order_sn:e});case 5:o=t.sent,n.clog("微信支付",o),0==o.code&&(i=o.data.params,this.orderInfo=i,r.requestPayment({provider:"wxpay",orderInfo:i,success:function(t){n.payOk=!0,n.modalShow("toastModal","支付成功")},fail:function(t){n.clog("Uni-pay-fail",t),-1!=t.errMsg.indexOf("payment微信:-2")?(n.modalName="dialogModal",n.dialogText="你取消了支付, 是否继续支付?",n.dialogSureText="继续支付"):elf.modalShow("toastModal",t.errMsg)}}));case 8:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),navRightHandle:function(){r.navigateTo({url:"./coinrecord",animationDuration:300,animationType:"fade-in"})},showTechargeModal:function(){this.modalName="bottomModal"},hideModal:function(){"bottomModal"==this.modalName&&(this.modalName=""),"dialogModal"==this.modalName&&(this.modalName="",this.orderInfo=null,this.api_OrderCancel())},properyHandle:function(){var e=c(a.default.mark(function e(n){var r;return a.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log(t(n," at pages\\user\\coin.vue:217")),e.next=3,this.api_OrderCreate(n);case 3:if(r=e.sent,!r){e.next=7;break}return e.next=7,this.api_WxPay(r);case 7:case"end":return e.stop()}},e,this)}));function n(t){return e.apply(this,arguments)}return n}(),dialogConfirm:function(){var e=this,n=this;console.log(t("继续支付",n.orderInfo," at pages\\user\\coin.vue:226")),r.requestPayment({provider:"wxpay",orderInfo:n.orderInfo,success:function(t){n.payOk=!0,e.modalName="",n.modalShow("toastModal","支付成功")},fail:function(t){if(n.clog("Uni-pay-fail",t),"dialogModal"==n.modalName)return!1;-1!=t.errMsg.indexOf("payment微信:-2")?(n.modalName="dialogModal",n.dialogText="你取消了支付, 是否继续支付?",n.dialogSureText="继续支付"):n.modalShow("toastModal",t.errMsg)}})},pointsTapHandle:function(t){}}};e.default=p}).call(this,n("0de9")["default"],n("6e42")["default"])},"2b96":function(t,e,n){},"84fd":function(t,e,n){"use strict";var r=n("2b96"),a=n.n(r);a.a},c7d3:function(t,e,n){"use strict";n.r(e);var r=n("27e3"),a=n.n(r);for(var o in r)"default"!==o&&function(t){n.d(e,t,function(){return r[t]})}(o);e["default"]=a.a},cc4d:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement;t._self._c},a=[];n.d(e,"a",function(){return r}),n.d(e,"b",function(){return a})},ef7a:function(t,e,n){"use strict";(function(t){n("e1e3"),n("921b");r(n("66fd"));var e=r(n("1870"));function r(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("6e42")["createPage"])}},[["ef7a","common/runtime","common/vendor"]]]);